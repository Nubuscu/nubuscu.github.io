import{A as u,D as m,c as f,d as S,m as j,f as E,l as v,g as C,a as F}from"./2.hyGT2CQe.js";import"./session.RykzrmOR.js";const N=e=>()=>({async network(t,{client:r,initialValue:a,resolve:n,marshalVariables:s}){if(t.artifact.kind===u.Fragment)return n(t,a);const i=t.fetch??globalThis.fetch,o={name:t.name,text:t.text,hash:t.hash,variables:s(t)};let c=w(r.url,t.fetchParams);e&&(typeof e=="string"?c=w(e,t.fetchParams):c=e);const l=await c({fetch:(p,h)=>{const b=T(o,h)??h;return i(p,b)},metadata:t.metadata,session:t.session||{},...o});n(t,{fetching:!1,variables:t.variables??{},data:l.data,errors:!l.errors||l.errors.length===0?null:l.errors,partial:!1,stale:!1,source:m.Network})}}),w=(e,t)=>{if(!e)throw new Error("Could not find configured client url. Please specify one in your HoudiniClient constructor.");return async({fetch:r,name:a,text:n,variables:s})=>await(await r(e,{method:"POST",body:JSON.stringify({operationName:a,query:n,variables:s}),...t,headers:{Accept:"application/graphql+json, application/json","Content-Type":"application/json",...t?.headers}})).json()};function T(e,t){const{files:r}=L({variables:e.variables});if(r.size){const a=t;let n={};if(a?.headers){const c=Object.entries(a?.headers).filter(([l,p])=>!(l.toLowerCase()=="content-type"&&p.toLowerCase()=="application/json"));n=Object.fromEntries(c)}const s=new FormData;t&&t?.body?s.set("operations",t?.body):s.set("operations",JSON.stringify({operationName:e.name,query:e.text,variables:e.variables}));const i={};let o=0;return r.forEach(c=>{i[++o]=c}),s.set("map",JSON.stringify(i)),o=0,r.forEach((c,l)=>{s.set(`${++o}`,l,l.name)}),{...a,headers:n,body:s}}}function A(e){return typeof File<"u"&&e instanceof File||typeof Blob<"u"&&e instanceof Blob}function L(e){if(!arguments.length)throw new TypeError("Argument 1 `value` is required.");const t=new Map,r=new Map;function a(n,s,i){if(A(n)){const l=r.get(n);return l?l.push(s):r.set(n,[s]),null}const o=Array.isArray(n)||typeof FileList<"u"&&n instanceof FileList,c=_(n);if(o||c){let l=t.get(n);const p=!l;if(p&&(l=o?[]:n instanceof Object?{}:Object.create(null),t.set(n,l)),!i.has(n)){const h=s?`${s}.`:"",b=new Set(i).add(n);if(o){let d=0;for(const y of n){const O=a(y,h+d++,b);p&&l.push(O)}}else for(const d in n){const y=a(n[d],h+d,b);p&&(l[d]=y)}}return l}return n}return{clone:a(e,"",new Set),files:r}}function _(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return(t===null||t===Object.prototype||Object.getPrototypeOf(t)===null)&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}const g=(e,t)=>()=>{const r=t(),a=s=>s?(i,o)=>i.artifact.kind!==e?o.next(i):s(i,o):void 0,n=s=>s?(i,o)=>i.artifact.kind!==e?o.resolve(i):s(i,o):void 0;return{start:a(r.start),network:a(r.network),afterNetwork:n(r.afterNetwork),end:n(r.end),catch:r.catch?(s,i)=>r.catch(s,i):void 0,cleanup:(...s)=>r.cleanup?.(...s)}},D=g(u.Query,function(){let e=null,t=null;return{start(r,{next:a}){r.variables={...t,...r.variables},a(r)},end(r,{resolve:a,marshalVariables:n,variablesChanged:s}){if(s(r)&&!r.cacheParams?.disableSubscriptions){e&&f.unsubscribe(e,e.variables?.()||{}),t={...n(r)};const i=t;e={rootType:r.artifact.rootType,selection:r.artifact.selection,variables:()=>i,set:o=>{a(r,{data:o,errors:null,fetching:!1,partial:!1,stale:!1,source:m.Cache,variables:r.variables??{}})}},f.subscribe(e,t)}a(r)},cleanup(){e&&(f.unsubscribe(e,e.variables?.()),t=null)}}}),k=g(u.Fragment,function(){let e=null,t=null;return{start(r,{next:a,resolve:n,variablesChanged:s,marshalVariables:i}){if(!r.stuff.parentID)return a(r);const o={parent:r.stuff.parentID,variables:i(r)};if(!r.cacheParams?.disableSubscriptions&&(!S(t,o)||s(r))){e&&f.unsubscribe(e,e.variables?.()||{});const c=i(r);e={rootType:r.artifact.rootType,selection:r.artifact.selection,variables:()=>c,parentID:r.stuff.parentID,set:l=>{n(r,{data:l,errors:null,fetching:!1,partial:!1,stale:!1,source:m.Cache,variables:c})}},f.subscribe(e,c),t=o}a(r)},cleanup(){e&&f.unsubscribe(e,e.variables?.())}}}),q=g(u.Mutation,()=>({async start(e,{next:t,marshalVariables:r}){const a=f._internal_unstable.storage.createLayer(!0),n=e.stuff.optimisticResponse;let s=[];n&&(s=f.write({selection:e.artifact.selection,data:await j({selection:e.artifact.selection,data:n}),variables:r(e),layer:a.id})),e.cacheParams={...e.cacheParams,layer:a,notifySubscribers:s,forceNotify:!0},t(e)},afterNetwork(e,{resolve:t}){e.cacheParams?.layer&&f.clearLayer(e.cacheParams.layer.id),t(e)},end(e,{resolve:t,value:r}){r.errors&&r.errors.length>0&&e.cacheParams?.layer&&f.clearLayer(e.cacheParams.layer.id),e.cacheParams?.layer&&f._internal_unstable.storage.resolveLayer(e.cacheParams.layer.id),t(e)},catch(e,{error:t}){if(e.cacheParams?.layer){const{layer:r}=e.cacheParams;f.clearLayer(r.id),f._internal_unstable.storage.resolveLayer(r.id)}throw t}})),I=({operations:e,error:t})=>()=>{const r=e.includes("all"),a=n=>r||{[u.Query]:e.includes("query"),[u.Mutation]:e.includes("mutation"),[u.Fragment]:!1,[u.Subscription]:e.includes("subscription")}[n];return{async end(n,{value:s,resolve:i}){if(s.errors&&s.errors.length>0&&a(n.artifact.kind))throw await(t??H)(s.errors,n);i(n)}}},H=async e=>new Error(e.map(t=>t.message).join(". ")+"."),M=(e=()=>({}))=>()=>({beforeNetwork(t,{next:r,marshalVariables:a}){r({...t,fetchParams:e({config:t.config,policy:t.policy,metadata:t.metadata,session:t.session,stuff:t.stuff,document:t.artifact,variables:a(t),text:t.text,hash:t.hash})})}}),R=[];var J=R;class B{url;plugins;throwOnError_operations;proxies={};componentCache={};constructor({url:t,fetchParams:r,plugins:a,pipeline:n,throwOnError:s}={}){if(a&&n)throw new Error("A client cannot be given a pipeline and a list of plugins at the same time.");this.throwOnError_operations=s?.operations??[],this.plugins=E([].concat(s?[I(s)]:[],M(r),n??[D,q,k].concat(a??[],J,N())));let i=globalThis.process?.env?.HOUDINI_PORT??"5173";this.url=t??(globalThis.window?"":`https://localhost:${i}`)+v(C())}observe({enableCache:t=!0,fetching:r=!1,...a}){return new F({client:this,plugins:P(this.plugins),fetching:r,enableCache:t,...a})}registerProxy(t,r){this.proxies[t]=r}}function P(e){return e.reduce((t,r)=>{if(typeof r!="function")throw new Error("Encountered client plugin that's not a function");const a=r();if(!a)return t;if(!Array.isArray(a))return t.concat(a);for(const n of a)if(n){if(typeof n=="function")return t.concat(P([n]));t.push(n)}return t},[])}const W=new B({url:"http://localhost:8081/query"});export{W as default};
